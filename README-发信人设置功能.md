# 发信人设置功能使用说明

## 功能概述

ChatMonitor 现在集成了发信人设置功能，允许用户通过图形界面轻松配置要监控的发信人，并且修改会立即生效。

## 主要特性

### 1. 图形界面设置
- 在主程序界面点击 **"发信人设置"** 按钮
- 弹出模态窗口，提供友好的用户界面
- 支持多行文本输入，适合长列表

### 2. 智能解析
- 自动识别中英文逗号（`,` 和 `，`）
- 自动清理空格和换行符
- 忽略空联系人条目

### 3. 立即生效
- 保存设置后立即更新内存中的目标联系人
- 无需重启程序，监控立即使用新的发信人列表
- 实时日志显示更新状态

### 4. 配置文件管理
- 自动读取 `~/ChatMonitor/config_with_yolo.yaml` 中的默认设置
- 保存修改到用户配置文件
- 支持重置为默认值

## 使用方法

### 1. 启动程序
```bash
# 激活conda环境
conda activate paddle

# 运行主程序
python3 main_monitor_gui_app.py
```

### 2. 设置发信人
1. 在主界面点击 **"发信人设置"** 按钮
2. 在弹出的窗口中输入发信人姓名
3. 多个发信人用逗号分隔，例如：
   - `张三,李四,王五`
   - `张三，李四，王五`
   - `张三, 李四, 王五`
4. 点击 **"保存设置"** 按钮
5. 设置立即生效，监控将使用新的发信人列表

### 3. 其他操作
- **重置为默认**：恢复配置文件中的默认发信人
- **清空**：清空当前输入的发信人列表
- **取消**：关闭设置窗口，不保存修改

## 技术实现

### 1. 界面集成
- 在主GUI类 `ChatMonitorGUI` 中添加了 `open_contacts_settings()` 方法
- 使用 `tk.Toplevel` 创建模态设置窗口
- 界面元素包括：标题、说明、输入框、按钮、状态标签

### 2. 配置管理
- 使用 `get_config()` 读取当前配置
- 通过 `update_target_contacts()` 立即更新内存中的目标联系人
- 保存到 `~/ChatMonitor/config_with_yolo.yaml` 用户配置文件

### 3. 文本解析
- 使用正则表达式 `re.split(r'[,，]', text)` 分割文本
- 自动清理每个联系人的前后空格
- 过滤空字符串

### 4. 错误处理
- 完善的异常捕获和错误提示
- 输入验证（至少需要一个发信人）
- 文件读写错误处理

## 配置文件结构

```yaml
chat_app:
  target_contacts: ["发信人1", "发信人2", "发信人3"]
```

## 测试验证

运行测试脚本验证功能：
```bash
python3 test_contacts_integration.py
```

## 注意事项

1. **权限要求**：确保程序有读写 `~/ChatMonitor/` 目录的权限
2. **配置文件**：如果用户配置文件不存在，会自动创建
3. **立即生效**：修改后监控线程会立即使用新的发信人列表
4. **日志记录**：所有设置更改都会记录到程序日志中

## 故障排除

### 问题1：设置窗口无法打开
- 检查tkinter是否正确安装
- 确认conda环境已激活

### 问题2：保存失败
- 检查 `~/ChatMonitor/` 目录是否存在
- 确认有写入权限
- 查看错误日志

### 问题3：设置不生效
- 确认点击了"保存设置"按钮
- 检查程序日志中的更新信息
- 重启程序测试

## 更新日志

- **v1.0**：初始版本，集成发信人设置功能
- 支持中英文逗号分隔
- 立即生效的配置更新
- 友好的图形界面 